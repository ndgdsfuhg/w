<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SKILL ARENA | Real-Time PvP Battle</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary: #6366f1;
            --secondary: #8b5cf6;
            --danger: #ef4444;
            --success: #10b981;
            --warning: #f59e0b;
        }
        
        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            font-family: 'Inter', sans-serif;
            overflow-x: hidden;
        }
        
        @keyframes typing {
            from { width: 0 }
            to { width: 100% }
        }
        
        @keyframes blink-caret {
            from, to { border-color: transparent }
            50% { border-color: var(--primary) }
        }
        
        .typing-indicator {
            display: inline-block;
            overflow: hidden;
            border-right: 2px solid var(--primary);
            white-space: nowrap;
            animation: typing 2s steps(20, end), blink-caret 0.5s step-end infinite;
        }
        
        .neon-glow {
            box-shadow: 0 0 20px rgba(99, 102, 241, 0.3),
                        0 0 40px rgba(99, 102, 241, 0.2),
                        0 0 60px rgba(99, 102, 241, 0.1);
        }
        
        .player-pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.8; }
        }
        
        .skill-badge {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: bold;
        }
        
        .chat-bubble {
            position: relative;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 8px 12px;
            margin: 4px;
            max-width: 200px;
        }
        
        .chat-bubble::before {
            content: '';
            position: absolute;
            bottom: -6px;
            left: 20px;
            width: 0;
            height: 0;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-top: 8px solid rgba(255, 255, 255, 0.1);
        }
        
        .rank-badge {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            color: #000;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 12px;
        }
        
        .online-dot {
            width: 8px;
            height: 8px;
            background: var(--success);
            border-radius: 50%;
            animation: online-pulse 2s infinite;
        }
        
        @keyframes online-pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .reaction-popup {
            position: absolute;
            animation: reaction-float 2s forwards;
            pointer-events: none;
            z-index: 1000;
        }
        
        @keyframes reaction-float {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-100px) scale(0.5); opacity: 0; }
        }
        
        .achievement-unlock {
            animation: achievement-pop 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        @keyframes achievement-pop {
            0% { transform: scale(0); opacity: 0; }
            70% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .matchmaking-pulse {
            animation: matchmaking-pulse 1.5s infinite;
        }
        
        @keyframes matchmaking-pulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(99, 102, 241, 0.7); }
            70% { box-shadow: 0 0 0 20px rgba(99, 102, 241, 0); }
        }
        
        .tilt-effect {
            transform: perspective(1000px) rotateX(0deg) rotateY(0deg);
            transition: transform 0.2s ease;
        }
        
        .elimination-flash {
            animation: elimination-flash 1s ease-out;
        }
        
        @keyframes elimination-flash {
            0% { background-color: rgba(239, 68, 68, 0.3); }
            100% { background-color: transparent; }
        }
    </style>
</head>
<body class="text-white min-h-screen relative overflow-hidden">
    <!-- Background Elements -->
    <div class="absolute inset-0 overflow-hidden pointer-events-none">
        <div class="absolute top-1/4 left-1/4 w-64 h-64 bg-purple-500/10 rounded-full blur-3xl"></div>
        <div class="absolute bottom-1/4 right-1/4 w-96 h-96 bg-indigo-500/10 rounded-full blur-3xl"></div>
    </div>
    
    <!-- Main Container -->
    <div class="container mx-auto px-4 py-6 relative z-10">
        <!-- Header with Matchmaking -->
        <header class="mb-8">
            <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                <div class="flex items-center space-x-4">
                    <div class="relative">
                        <div class="w-12 h-12 bg-gradient-to-br from-indigo-600 to-purple-600 rounded-xl flex items-center justify-center neon-glow">
                            <i class="fas fa-crosshairs text-xl"></i>
                        </div>
                        <div class="absolute -top-2 -right-2">
                            <span class="rank-badge">1</span>
                        </div>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold bg-gradient-to-r from-indigo-400 to-purple-400 bg-clip-text text-transparent">
                            SKILL ARENA
                        </h1>
                        <p class="text-sm text-gray-400">Real-time PvP ‚Ä¢ ELO Rating ‚Ä¢ Live Matches</p>
                    </div>
                </div>
                
                <!-- Matchmaking Status -->
                <div id="matchmakingStatus" class="glass p-4 rounded-2xl min-w-[300px] hidden">
                    <div class="flex items-center justify-between mb-3">
                        <div class="flex items-center space-x-2">
                            <div class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div>
                            <span class="font-bold">Finding Opponents...</span>
                        </div>
                        <button id="cancelMatchmaking" class="text-sm text-gray-400 hover:text-white">
                            Cancel
                        </button>
                    </div>
                    <div class="space-y-2">
                        <div class="flex justify-between text-sm">
                            <span>Skill Range:</span>
                            <span id="skillRange" class="font-bold">1500-1700 ELO</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span>Players Found:</span>
                            <span id="playersFound" class="font-bold">6/10</span>
                        </div>
                        <div class="w-full bg-gray-800 rounded-full h-2">
                            <div id="matchmakingProgress" class="bg-gradient-to-r from-green-500 to-blue-500 h-2 rounded-full transition-all duration-1000" style="width: 60%"></div>
                        </div>
                    </div>
                </div>
                
                <!-- User Profile -->
                <div class="flex items-center space-x-4">
                    <div class="text-right hidden md:block">
                        <p class="font-bold" id="playerName">Guest_Player</p>
                        <p class="text-sm text-gray-400">ELO: <span id="playerElo" class="text-green-400">1500</span></p>
                    </div>
                    <div class="relative">
                        <div id="playerAvatar" class="w-12 h-12 bg-gradient-to-br from-gray-800 to-gray-900 rounded-xl flex items-center justify-center cursor-pointer hover:scale-105 transition-transform border-2 border-indigo-500/50">
                            <span class="text-xl">üë§</span>
                        </div>
                        <div class="online-dot absolute -bottom-1 -right-1"></div>
                    </div>
                </div>
            </div>
        </header>
        
        <!-- Main Game Dashboard -->
        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6 mb-8">
            <!-- Left Sidebar - Chat & Players -->
            <div class="lg:col-span-1 space-y-6">
                <!-- Live Chat -->
                <div class="glass rounded-2xl p-4 h-[400px] flex flex-col">
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="font-bold flex items-center">
                            <i class="fas fa-comments mr-2 text-indigo-400"></i>
                            Arena Chat
                        </h3>
                        <div class="flex items-center space-x-2">
                            <span class="text-xs text-green-400 flex items-center">
                                <span class="w-2 h-2 bg-green-500 rounded-full mr-1"></span>
                                <span id="onlineCount">342</span> online
                            </span>
                        </div>
                    </div>
                    
                    <div id="chatMessages" class="flex-1 overflow-y-auto space-y-3 mb-3">
                        <!-- Chat messages will be added here -->
                    </div>
                    
                    <div class="flex space-x-2">
                        <input type="text" 
                               id="chatInput" 
                               placeholder="Type a message..." 
                               class="flex-1 bg-gray-900/50 border border-gray-700 rounded-xl px-4 py-2 text-sm focus:outline-none focus:border-indigo-500"
                               maxlength="100">
                        <button id="sendMessage" class="bg-gradient-to-r from-indigo-600 to-purple-600 px-4 rounded-xl hover:opacity-90 transition">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Active Players List -->
                <div class="glass rounded-2xl p-4">
                    <h3 class="font-bold mb-3 flex items-center">
                        <i class="fas fa-users mr-2 text-green-400"></i>
                        Active Players
                    </h3>
                    <div id="activePlayers" class="space-y-2 max-h-[200px] overflow-y-auto">
                        <!-- Active players will be added here -->
                    </div>
                </div>
                
                <!-- Quick Stats -->
                <div class="glass rounded-2xl p-4">
                    <div class="grid grid-cols-2 gap-3">
                        <div class="text-center p-3 bg-gradient-to-br from-gray-900 to-gray-800 rounded-xl">
                            <p class="text-2xl font-bold text-green-400" id="winRate">62%</p>
                            <p class="text-xs text-gray-400">Win Rate</p>
                        </div>
                        <div class="text-center p-3 bg-gradient-to-br from-gray-900 to-gray-800 rounded-xl">
                            <p class="text-2xl font-bold text-blue-400" id="avgTime">14.7s</p>
                            <p class="text-xs text-gray-400">Avg. Survival</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Center Arena -->
            <div class="lg:col-span-2">
                <!-- Game Arena -->
                <div class="glass rounded-2xl overflow-hidden relative h-[600px]">
                    <!-- Matchmaking Screen -->
                    <div id="matchmakingScreen" class="absolute inset-0 bg-gradient-to-br from-gray-900 to-gray-950 flex items-center justify-center z-20">
                        <div class="text-center p-8 max-w-md">
                            <div class="w-24 h-24 mx-auto mb-6 rounded-full bg-gradient-to-r from-indigo-600 to-purple-600 flex items-center justify-center matchmaking-pulse">
                                <i class="fas fa-search text-3xl"></i>
                            </div>
                            <h2 class="text-3xl font-bold mb-4 bg-gradient-to-r from-indigo-400 to-purple-400 bg-clip-text text-transparent">
                                Ready for Battle?
                            </h2>
                            <p class="text-gray-400 mb-8">
                                Find opponents matching your skill level.<br>
                                ELO Range: <span class="text-green-400 font-bold">1500-1700</span>
                            </p>
                            <button id="startMatchmaking" class="bg-gradient-to-r from-indigo-600 to-purple-600 text-white px-12 py-4 rounded-2xl font-bold text-lg hover:scale-105 transition-transform">
                                FIND MATCH
                            </button>
                            <div class="mt-6 text-sm text-gray-500">
                                <p><i class="fas fa-bolt text-yellow-500 mr-2"></i> Average wait: 15 seconds</p>
                                <p><i class="fas fa-trophy text-yellow-500 mr-2"></i> Prize: 50-200 $REACT</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Game Canvas -->
                    <canvas id="gameCanvas" width="800" height="600" class="w-full h-full"></canvas>
                    
                    <!-- In-Game UI -->
                    <div id="gameUI" class="absolute top-4 left-4 right-4 z-10 hidden">
                        <div class="flex justify-between items-center mb-4">
                            <div class="flex items-center space-x-4">
                                <div class="bg-gray-900/80 backdrop-blur-sm rounded-xl px-4 py-2">
                                    <p class="text-sm text-gray-400">Tournament #</p>
                                    <p class="font-bold text-lg">AF-882-90X</p>
                                </div>
                                <div class="bg-gray-900/80 backdrop-blur-sm rounded-xl px-4 py-2">
                                    <p class="text-sm text-gray-400">Prize Pool</p>
                                    <p class="font-bold text-lg text-green-400">$14,850</p>
                                </div>
                            </div>
                            
                            <div class="flex items-center space-x-3">
                                <div id="countdownTimer" class="bg-red-900/80 backdrop-blur-sm rounded-xl px-4 py-2">
                                    <p class="text-sm text-gray-400">Match Ends In</p>
                                    <p class="font-bold text-lg text-red-400">02:45</p>
                                </div>
                                <button id="surrenderBtn" class="bg-red-600/80 hover:bg-red-700 backdrop-blur-sm rounded-xl px-4 py-2 text-sm font-bold">
                                    <i class="fas fa-flag mr-2"></i>Surrender
                                </button>
                            </div>
                        </div>
                        
                        <!-- Players Health/Status -->
                        <div id="playersStatus" class="grid grid-cols-5 gap-3 mb-4">
                            <!-- Players status will be added here -->
                        </div>
                    </div>
                    
                    <!-- Game Over Screen -->
                    <div id="gameOverScreen" class="absolute inset-0 bg-gradient-to-br from-gray-900/95 to-gray-950/95 hidden items-center justify-center z-30">
                        <div class="text-center p-8 max-w-lg">
                            <div id="victoryIcon" class="w-32 h-32 mx-auto mb-6 rounded-full bg-gradient-to-r from-yellow-600 to-orange-600 flex items-center justify-center">
                                <i class="fas fa-trophy text-5xl"></i>
                            </div>
                            <h2 id="gameResultTitle" class="text-4xl font-bold mb-4">VICTORY!</h2>
                            <p id="gameResultSubtitle" class="text-xl text-gray-300 mb-6">You are the last survivor!</p>
                            
                            <div class="bg-gray-900/80 rounded-2xl p-6 mb-8">
                                <div class="grid grid-cols-2 gap-6">
                                    <div class="text-center">
                                        <p class="text-3xl font-bold text-green-400" id="rewardAmount">$1,350</p>
                                        <p class="text-sm text-gray-400">Prize Won</p>
                                    </div>
                                    <div class="text-center">
                                        <p class="text-3xl font-bold text-blue-400" id="eloChange">+24</p>
                                        <p class="text-sm text-gray-400">ELO Change</p>
                                    </div>
                                </div>
                                <div class="mt-6 pt-6 border-t border-gray-800">
                                    <p class="text-sm text-gray-400">Match Statistics</p>
                                    <div class="flex justify-between text-sm mt-2">
                                        <span>Survival Time:</span>
                                        <span class="font-bold" id="matchTime">42.7 seconds</span>
                                    </div>
                                    <div class="flex justify-between text-sm mt-1">
                                        <span>Players Eliminated:</span>
                                        <span class="font-bold text-red-400" id="eliminations">8</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="flex space-x-4">
                                <button id="playAgainBtn" class="flex-1 bg-gradient-to-r from-indigo-600 to-purple-600 text-white py-4 rounded-2xl font-bold hover:scale-105 transition-transform">
                                    PLAY AGAIN
                                </button>
                                <button id="shareResultBtn" class="flex-1 bg-gray-800 text-white py-4 rounded-2xl font-bold hover:bg-gray-700 transition">
                                    <i class="fas fa-share-alt mr-2"></i>SHARE
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Tournament Leaderboard -->
                <div class="mt-6 glass rounded-2xl p-4">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-bold"><i class="fas fa-crown mr-2 text-yellow-500"></i>Current Tournament</h3>
                        <div class="flex items-center space-x-2">
                            <span class="text-sm text-gray-400">Time Remaining:</span>
                            <span class="font-bold text-red-400">01:23:45</span>
                        </div>
                    </div>
                    <div id="tournamentLeaderboard" class="space-y-2">
                        <!-- Leaderboard entries will be added here -->
                    </div>
                </div>
            </div>
            
            <!-- Right Sidebar - Player Stats & Achievements -->
            <div class="lg:col-span-1 space-y-6">
                <!-- Player Profile Card -->
                <div class="glass rounded-2xl p-4">
                    <div class="flex items-center space-x-3 mb-4">
                        <div class="relative">
                            <div class="w-16 h-16 bg-gradient-to-br from-indigo-600 to-purple-600 rounded-xl flex items-center justify-center border-4 border-gray-800">
                                <span class="text-2xl">üëë</span>
                            </div>
                            <div class="absolute -bottom-2 -right-2 bg-gradient-to-r from-yellow-500 to-orange-500 text-xs font-bold px-2 py-1 rounded">
                                PRO
                            </div>
                        </div>
                        <div>
                            <h3 class="font-bold text-lg" id="profileName">CryptoWarrior</h3>
                            <div class="flex items-center space-x-2">
                                <span class="skill-badge">ELO 1524</span>
                                <span class="skill-badge bg-green-600">Top 5%</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="space-y-3">
                        <div>
                            <div class="flex justify-between text-sm mb-1">
                                <span>Win Streak</span>
                                <span class="font-bold text-green-400" id="winStreak">3</span>
                            </div>
                            <div class="w-full bg-gray-800 rounded-full h-2">
                                <div class="bg-gradient-to-r from-green-500 to-blue-500 h-2 rounded-full" style="width: 60%"></div>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-3 gap-2 text-center">
                            <div class="p-2 bg-gray-900/50 rounded-lg">
                                <p class="text-xl font-bold" id="totalMatches">124</p>
                                <p class="text-xs text-gray-400">Matches</p>
                            </div>
                            <div class="p-2 bg-gray-900/50 rounded-lg">
                                <p class="text-xl font-bold text-green-400" id="wins">78</p>
                                <p class="text-xs text-gray-400">Wins</p>
                            </div>
                            <div class="p-2 bg-gray-900/50 rounded-lg">
                                <p class="text-xl font-bold text-red-400" id="losses">46</p>
                                <p class="text-xs text-gray-400">Losses</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Recent Achievements -->
                <div class="glass rounded-2xl p-4">
                    <h3 class="font-bold mb-3"><i class="fas fa-trophy mr-2 text-yellow-500"></i>Recent Achievements</h3>
                    <div id="achievementsList" class="space-y-3">
                        <!-- Achievements will be added here -->
                    </div>
                </div>
                
                <!-- Friends Activity -->
                <div class="glass rounded-2xl p-4">
                    <h3 class="font-bold mb-3"><i class="fas fa-user-friends mr-2 text-blue-400"></i>Friends Activity</h3>
                    <div id="friendsActivity" class="space-y-3">
                        <!-- Friends activity will be added here -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Footer Stats -->
        <footer class="mt-8 pt-6 border-t border-gray-800">
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div class="text-center">
                    <p class="text-2xl font-bold text-green-400">1,245</p>
                    <p class="text-sm text-gray-400">Players Online</p>
                </div>
                <div class="text-center">
                    <p class="text-2xl font-bold text-blue-400">42</p>
                    <p class="text-sm text-gray-400">Active Matches</p>
                </div>
                <div class="text-center">
                    <p class="text-2xl font-bold text-purple-400">$89,450</p>
                    <p class="text-sm text-gray-400">Daily Prize Pool</p>
                </div>
                <div class="text-center">
                    <p class="text-2xl font-bold text-yellow-400">3.2s</p>
                    <p class="text-sm text-gray-400">Avg. Reaction Time</p>
                </div>
            </div>
        </footer>
    </div>
    
    <!-- Reaction Popups Container -->
    <div id="reactionContainer" class="fixed inset-0 pointer-events-none z-40"></div>
    
    <!-- Game Engine -->
    <script>
        // Advanced AI Bot System
        class AdvancedBot {
            constructor(id, name, avatar, skillLevel) {
                this.id = id;
                this.name = name;
                this.avatar = avatar;
                this.skillLevel = skillLevel; // 1-10
                this.alive = true;
                this.x = 100 + Math.random() * 600;
                this.y = 100 + Math.random() * 400;
                this.size = 12 + skillLevel;
                this.speed = 1.5 + (skillLevel * 0.3);
                this.reactionTime = 100 + (10 - skillLevel) * 20; // ms
                this.health = 100;
                this.lastMove = Date.now();
                this.movePattern = [];
                this.personality = this.generatePersonality();
                this.target = null;
                this.avoidance = [];
                this.prediction = { x: 0, y: 0 };
                this.strategy = this.selectStrategy();
                this.chatCooldown = 0;
                
                // Bot-specific characteristics
                this.playStyle = ['aggressive', 'defensive', 'adaptive', 'tricky'][Math.floor(Math.random() * 4)];
                this.chatPersonality = ['friendly', 'competitive', 'silent', 'toxic'][Math.floor(Math.random() * 4)];
                this.skillSet = this.generateSkillSet();
            }
            
            generatePersonality() {
                return {
                    riskTolerance: 0.3 + Math.random() * 0.7,
                    aggression: 0.3 + Math.random() * 0.7,
                    patience: 0.3 + Math.random() * 0.7,
                    adaptability: 0.3 + Math.random() * 0.7,
                    predictionSkill: 0.3 + Math.random() * 0.7
                };
            }
            
            generateSkillSet() {
                const skills = [];
                if (this.skillLevel > 7) skills.push('zonePrediction');
                if (this.skillLevel > 5) skills.push('playerTracking');
                if (this.skillLevel > 6) skills.push('dodgeMaster');
                if (this.skillLevel > 4) skills.push('quickReactions');
                if (Math.random() > 0.5) skills.push('chatTrashTalk');
                return skills;
            }
            
            selectStrategy() {
                const strategies = [
                    'centerControl', 'edgeSurvival', 'playerHunt', 'safeFollowing',
                    'patternMovement', 'reactionBased', 'predictionBased'
                ];
                return strategies[Math.floor(Math.random() * strategies.length)];
            }
            
            update(gameState) {
                if (!this.alive) return;
                
                const currentTime = Date.now();
                const timeSinceLastMove = currentTime - this.lastMove;
                
                // Only make decisions at reaction time intervals
                if (timeSinceLastMove < this.reactionTime) return;
                
                this.lastMove = currentTime;
                
                // Update chat cooldown
                if (this.chatCooldown > 0) this.chatCooldown--;
                
                // Make strategic decision
                this.makeDecision(gameState);
                
                // Occasionally send chat message
                if (this.chatCooldown === 0 && Math.random() < 0.01) {
                    this.sendChatMessage(gameState);
                    this.chatCooldown = 100 + Math.random() * 200; // 10-30 seconds
                }
                
                // Execute movement
                this.executeMovement(gameState);
                
                // Update health based on zone
                this.updateHealth(gameState);
            }
            
            makeDecision(gameState) {
                const { safeZone, players, gameTime } = gameState;
                
                // Advanced decision making based on strategy
                switch(this.strategy) {
                    case 'centerControl':
                        this.target = { x: safeZone.x, y: safeZone.y };
                        break;
                        
                    case 'edgeSurvival':
                        const angle = gameTime * 0.1;
                        this.target = {
                            x: safeZone.x + Math.cos(angle) * (safeZone.radius * 0.8),
                            y: safeZone.y + Math.sin(angle) * (safeZone.radius * 0.8)
                        };
                        break;
                        
                    case 'playerHunt':
                        // Find closest player to hunt
                        const closestPlayer = this.findClosestPlayer(players);
                        if (closestPlayer) {
                            this.target = { x: closestPlayer.x, y: closestPlayer.y };
                            // Predict player movement
                            if (this.skillSet.includes('playerTracking')) {
                                this.predictPlayerMovement(closestPlayer);
                            }
                        }
                        break;
                        
                    case 'safeFollowing':
                        // Follow safe zone edge at optimal distance
                        const zoneAngle = Math.atan2(this.y - safeZone.y, this.x - safeZone.x);
                        const optimalDistance = safeZone.radius * 0.9;
                        this.target = {
                            x: safeZone.x + Math.cos(zoneAngle) * optimalDistance,
                            y: safeZone.y + Math.sin(zoneAngle) * optimalDistance
                        };
                        break;
                }
                
                // Adapt strategy based on situation
                if (this.personality.adaptability > 0.7 && Math.random() < 0.1) {
                    this.strategy = this.selectStrategy();
                }
                
                // Generate movement pattern for tricky bots
                if (this.playStyle === 'tricky' && this.movePattern.length < 3) {
                    this.movePattern.push({
                        x: this.x + (Math.random() - 0.5) * 100,
                        y: this.y + (Math.random() - 0.5) * 100,
                        duration: 500 + Math.random() * 1000
                    });
                }
            }
            
            findClosestPlayer(players) {
                let closest = null;
                let closestDistance = Infinity;
                
                players.forEach(player => {
                    if (!player.alive || player.isBot) return;
                    const dx = player.x - this.x;
                    const dy = player.y - this.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance < closestDistance) {
                        closestDistance = distance;
                        closest = player;
                    }
                });
                
                return closest;
            }
            
            predictPlayerMovement(player) {
                // Simple prediction based on current velocity
                const predictionTime = 0.5; // 0.5 seconds ahead
                this.prediction = {
                    x: player.x + (player.x - player.lastX || 0) * predictionTime,
                    y: player.y + (player.y - player.lastY || 0) * predictionTime
                };
                
                if (this.target) {
                    this.target.x = this.prediction.x;
                    this.target.y = this.prediction.y;
                }
            }
            
            executeMovement(gameState) {
                if (!this.target) return;
                
                const dx = this.target.x - this.x;
                const dy = this.target.y - this.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance > 2) {
                    // Add some randomness to movement to appear more human
                    const randomness = 0.1 * (1 - this.skillLevel / 10);
                    const moveX = (dx / distance) * this.speed + (Math.random() - 0.5) * randomness;
                    const moveY = (dy / distance) * this.speed + (Math.random() - 0.5) * randomness;
                    
                    this.x += moveX;
                    this.y += moveY;
                    
                    // Boundary check
                    this.x = Math.max(20, Math.min(780, this.x));
                    this.y = Math.max(20, Math.min(580, this.y));
                }
                
                // Execute pattern moves for tricky bots
                if (this.movePattern.length > 0) {
                    const pattern = this.movePattern[0];
                    const pdx = pattern.x - this.x;
                    const pdy = pattern.y - this.y;
                    const pdist = Math.sqrt(pdx * pdx + pdy * pdy);
                    
                    if (pdist < 5) {
                        this.movePattern.shift();
                    }
                }
            }
            
            updateHealth(gameState) {
                const { safeZone } = gameState;
                const distanceToZone = Math.sqrt(
                    Math.pow(this.x - safeZone.x, 2) + 
                    Math.pow(this.y - safeZone.y, 2)
                );
                
                if (distanceToZone > safeZone.radius) {
                    this.health -= 2;
                    if (this.health <= 0) {
                        this.alive = false;
                        gameState.addReaction(this.x, this.y, 'üíÄ', 'text-red-400');
                        gameState.addChatMessage(`${this.name} was eliminated!`, 'system');
                    }
                } else if (this.health < 100) {
                    this.health += 0.5; // Regenerate in safe zone
                }
            }
            
            sendChatMessage(gameState) {
                if (this.chatPersonality === 'silent') return;
                
                const messages = {
                    friendly: [
                        "Good luck everyone!",
                        "Nice moves!",
                        "This is intense!",
                        "Let's have a fair fight!",
                        "Great game so far!",
                        "Almost there!"
                    ],
                    competitive: [
                        "Bring it on!",
                        "I'm winning this!",
                        "Too easy!",
                        "Who's next?",
                        "You can't beat me!",
                        "I'm unstoppable!"
                    ],
                    toxic: [
                        "Noobs everywhere...",
                        "EZ game",
                        "You guys are terrible",
                        "Waste of my time",
                        "Git gud",
                        "Report my team!"
                    ]
                };
                
                if (messages[this.chatPersonality]) {
                    const msg = messages[this.chatPersonality][
                        Math.floor(Math.random() * messages[this.chatPersonality].length)
                    ];
                    gameState.addChatMessage(`${this.name}: ${msg}`, 'bot');
                }
            }
            
            draw(ctx) {
                if (!this.alive) return;
                
                // Draw bot with personality-based color
                const color = this.getBotColor();
                
                // Draw health bar
                ctx.fillStyle = '#333';
                ctx.fillRect(this.x - 15, this.y - 20, 30, 4);
                ctx.fillStyle = this.health > 50 ? '#10b981' : '#ef4444';
                ctx.fillRect(this.x - 15, this.y - 20, 30 * (this.health / 100), 4);
                
                // Draw bot circle
                ctx.fillStyle = color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
                
                // Draw bot avatar
                ctx.font = '14px Arial';
                ctx.fillStyle = '#FFFFFF';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(this.avatar, this.x, this.y);
                
                // Draw skill level indicator for high-level bots
                if (this.skillLevel > 7) {
                    ctx.fillStyle = '#f59e0b';
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size + 3, 0, Math.PI * 2);
                    ctx.stroke();
                }
            }
            
            getBotColor() {
                const colors = {
                    aggressive: '#ef4444',
                    defensive: '#3b82f6',
                    adaptive: '#10b981',
                    tricky: '#8b5cf6'
                };
                return colors[this.playStyle] || '#6b7280';
            }
        }
        
        // Main Game Engine
        class PvPGameEngine {
            constructor() {
                this.canvas = document.getElementById('gameCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.gameActive = false;
                this.gameTime = 0;
                this.matchDuration = 180; // 3 minutes
                this.safeZone = { x: 400, y: 300, radius: 250, targetRadius: 250, shrinkSpeed: 0.5 };
                this.player = { x: 400, y: 300, size: 15, alive: true, health: 100 };
                this.bots = [];
                this.reactions = [];
                this.chatMessages = [];
                this.eliminations = 0;
                this.matchStartTime = 0;
                this.lastFrameTime = 0;
                this.animationId = null;
                
                this.init();
            }
            
            init() {
                this.createRealisticBots();
                this.setupEventListeners();
                this.startGameLoop();
                this.populateInitialChat();
                this.updateActivePlayers();
                this.updateTournamentLeaderboard();
                this.updateAchievements();
                this.updateFriendsActivity();
            }
            
            createRealisticBots() {
                const botNames = [
                    'CryptoWhale', '0xHunter', 'AlphaTrader', 'RichKidNFT', 'SatoshiFan',
                    'BullRunner', 'MarsShot', 'MidasTouch', 'VoidWalker', 'DeFiKing',
                    'Web3Warrior', 'TokenMaster', 'BlockchainBro', 'SmartContract',
                    'OracleNode', 'LiquidityPool', 'YieldFarmer', 'GasFeeCry'
                ];
                
                const botAvatars = ['üê≥', 'üëÅÔ∏è', 'üê∫', 'üí∞', 'üë§', 'üêÇ', 'üöÄ', 'üëë', 'üåå', 'ü§ñ', 'ü¶∏', 'üßô', 'üë®‚Äçüíª', 'üéÆ', 'üëΩ', 'ü¶Ñ', 'üêâ', 'ü¶Ö'];
                
                this.bots = [];
                for (let i = 0; i < 9; i++) {
                    const skillLevel = this.generateSkillDistribution(i);
                    const bot = new AdvancedBot(
                        i,
                        botNames[i],
                        botAvatars[i],
                        skillLevel
                    );
                    
                    // Set realistic starting positions
                    const angle = (i / 9) * Math.PI * 2;
                    const distance = 150 + Math.random() * 100;
                    bot.x = 400 + Math.cos(angle) * distance;
                    bot.y = 300 + Math.sin(angle) * distance;
                    
                    this.bots.push(bot);
                }
            }
            
            generateSkillDistribution(index) {
                // Create a realistic skill distribution
                const distribution = [3, 4, 5, 5, 6, 6, 7, 8, 9]; // One very skilled bot
                return distribution[index] || 5;
            }
            
            setupEventListeners() {
                // Player movement
                this.canvas.addEventListener('mousemove', (e) => {
                    if (!this.gameActive || !this.player.alive) return;
                    const rect = this.canvas.getBoundingClientRect();
                    this.player.x = e.clientX - rect.left;
                    this.player.y = e.clientY - rect.top;
                });
                
                this.canvas.addEventListener('touchmove', (e) => {
                    if (!this.gameActive || !this.player.alive) return;
                    e.preventDefault();
                    const rect = this.canvas.getBoundingClientRect();
                    this.player.x = e.touches[0].clientX - rect.left;
                    this.player.y = e.touches[0].clientY - rect.top;
                });
                
                // Quick reactions
                this.canvas.addEventListener('click', (e) => {
                    if (!this.gameActive) return;
                    this.addReaction(this.player.x, this.player.y, 'üëä', 'text-yellow-400');
                });
                
                // Surrender button
                document.getElementById('surrenderBtn')?.addEventListener('click', () => {
                    if (this.gameActive && this.player.alive) {
                        this.player.alive = false;
                        this.addChatMessage('Player surrendered the match!', 'system');
                        this.endGame(false);
                    }
                });
            }
            
            startGameLoop() {
                const animate = (currentTime) => {
                    if (!this.lastFrameTime) this.lastFrameTime = currentTime;
                    const deltaTime = (currentTime - this.lastFrameTime) / 1000;
                    this.lastFrameTime = currentTime;
                    
                    if (this.gameActive) {
                        this.update(deltaTime);
                        this.updateGameUI();
                    }
                    
                    this.draw();
                    this.animationId = requestAnimationFrame(animate);
                };
                
                this.animationId = requestAnimationFrame(animate);
            }
            
            startMatch() {
                this.gameActive = true;
                this.gameTime = 0;
                this.matchStartTime = Date.now();
                this.player.alive = true;
                this.player.health = 100;
                this.eliminations = 0;
                this.safeZone.radius = 250;
                this.safeZone.targetRadius = 250;
                
                // Reset bots
                this.createRealisticBots();
                
                // Show game UI
                document.getElementById('gameUI').classList.remove('hidden');
                document.getElementById('matchmakingScreen').style.display = 'none';
                
                // Initial chat message
                this.addChatMessage('Match started! Good luck everyone!', 'system');
                this.addReaction(400, 300, 'üéÆ', 'text-blue-400');
                
                // Simulate player reactions
                setTimeout(() => {
                    this.bots[0].sendChatMessage(this);
                }, 2000);
                
                setTimeout(() => {
                    this.bots[3].sendChatMessage(this);
                }, 4000);
            }
            
            update(deltaTime) {
                this.gameTime += deltaTime;
                
                // Update safe zone (shrinks over time)
                const shrinkFactor = Math.min(1, this.gameTime / 60); // Full shrink after 60 seconds
                this.safeZone.targetRadius = Math.max(50, 250 - (shrinkFactor * 200));
                this.safeZone.radius += (this.safeZone.targetRadius - this.safeZone.radius) * 0.02;
                
                // Update player health
                this.updatePlayerHealth();
                
                // Update bots
                const gameState = {
                    safeZone: this.safeZone,
                    players: [this.player, ...this.bots],
                    gameTime: this.gameTime
                };
                
                this.bots.forEach(bot => {
                    if (bot.alive) {
                        bot.update(gameState);
                    }
                });
                
                // Check player elimination
                if (this.player.health <= 0 && this.player.alive) {
                    this.player.alive = false;
                    this.addChatMessage('Player was eliminated!', 'system');
                    this.addReaction(this.player.x, this.player.y, 'üíÄ', 'text-red-400');
                    this.endGame(false);
                }
                
                // Check win condition
                const aliveBots = this.bots.filter(b => b.alive).length;
                if (aliveBots === 0 && this.player.alive) {
                    this.endGame(true);
                }
                
                // Check match timeout
                if (this.gameTime >= this.matchDuration) {
                    this.endGame(this.player.alive);
                }
                
                // Update reactions
                this.updateReactions(deltaTime);
                
                // Random game events
                if (Math.random() < 0.01) {
                    this.randomGameEvent();
                }
            }
            
            updatePlayerHealth() {
                const distanceToZone = Math.sqrt(
                    Math.pow(this.player.x - this.safeZone.x, 2) + 
                    Math.pow(this.player.y - this.safeZone.y, 2)
                );
                
                if (distanceToZone > this.safeZone.radius) {
                    this.player.health -= 3 * (distanceToZone - this.safeZone.radius) / 100;
                } else if (this.player.health < 100) {
                    this.player.health += 1; // Regenerate in safe zone
                }
                
                this.player.health = Math.max(0, Math.min(100, this.player.health));
            }
            
            updateGameUI() {
                // Update timer
                const timeLeft = this.matchDuration - this.gameTime;
                const minutes = Math.floor(timeLeft / 60);
                const seconds = Math.floor(timeLeft % 60);
                document.getElementById('countdownTimer').querySelector('.text-lg').textContent = 
                    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                // Update players status
                this.updatePlayersStatus();
                
                // Update safe zone display
                const zonePercent = Math.round((this.safeZone.radius / 250) * 100);
                document.querySelector('#playersStatus + div')?.remove();
            }
            
            updatePlayersStatus() {
                const container = document.getElementById('playersStatus');
                if (!container) return;
                
                container.innerHTML = '';
                
                // Player status
                container.innerHTML += `
                    <div class="bg-gradient-to-r from-indigo-600/30 to-purple-600/30 rounded-xl p-3">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-2">
                                <span class="text-lg">üë§</span>
                                <div>
                                    <p class="font-bold text-sm">You</p>
                                    <p class="text-xs text-green-400">${Math.round(this.player.health)}% HP</p>
                                </div>
                            </div>
                            <span class="skill-badge">#1</span>
                        </div>
                    </div>
                `;
                
                // Bot status
                this.bots.slice(0, 4).forEach((bot, index) => {
                    if (!bot.alive) return;
                    
                    container.innerHTML += `
                        <div class="bg-gray-900/50 rounded-xl p-3">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-2">
                                    <span class="text-lg">${bot.avatar}</span>
                                    <div>
                                        <p class="font-bold text-sm">${bot.name}</p>
                                        <p class="text-xs ${bot.health > 50 ? 'text-green-400' : 'text-red-400'}">
                                            ${Math.round(bot.health)}% HP
                                        </p>
                                    </div>
                                </div>
                                <span class="skill-badge bg-gray-700">${bot.skillLevel}/10</span>
                            </div>
                        </div>
                    `;
                });
            }
            
            draw() {
                // Clear canvas
                this.ctx.fillStyle = '#0f172a';
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
                
                // Draw grid background
                this.drawGrid();
                
                // Draw safe zone
                this.drawSafeZone();
                
                // Draw bots
                this.bots.forEach(bot => bot.draw(this.ctx));
                
                // Draw player
                this.drawPlayer();
                
                // Draw reactions
                this.drawReactions();
                
                // Draw game info
                this.drawGameInfo();
            }
            
            drawGrid() {
                this.ctx.strokeStyle = 'rgba(255, 255, 255, 0.05)';
                this.ctx.lineWidth = 1;
                
                // Vertical lines
                for (let x = 0; x <= this.canvas.width; x += 50) {
                    this.ctx.beginPath();
                    this.ctx.moveTo(x, 0);
                    this.ctx.lineTo(x, this.canvas.height);
                    this.ctx.stroke();
                }
                
                // Horizontal lines
                for (let y = 0; y <= this.canvas.height; y += 50) {
                    this.ctx.beginPath();
                    this.ctx.moveTo(0, y);
                    this.ctx.lineTo(this.canvas.width, y);
                    this.ctx.stroke();
                }
            }
            
            drawSafeZone() {
                // Zone gradient
                const gradient = this.ctx.createRadialGradient(
                    this.safeZone.x, this.safeZone.y, 0,
                    this.safeZone.x, this.safeZone.y, this.safeZone.radius
                );
                gradient.addColorStop(0, 'rgba(59, 130, 246, 0.2)');
                gradient.addColorStop(0.7, 'rgba(59, 130, 246, 0.05)');
                gradient.addColorStop(1, 'rgba(59, 130, 246, 0)');
                
                this.ctx.fillStyle = gradient;
                this.ctx.beginPath();
                this.ctx.arc(this.safeZone.x, this.safeZone.y, this.safeZone.radius, 0, Math.PI * 2);
                this.ctx.fill();
                
                // Zone border
                this.ctx.strokeStyle = '#3b82f6';
                this.ctx.lineWidth = 3;
                this.ctx.setLineDash([10, 5]);
                this.ctx.beginPath();
                this.ctx.arc(this.safeZone.x, this.safeZone.y, this.safeZone.radius, 0, Math.PI * 2);
                this.ctx.stroke();
                this.ctx.setLineDash([]);
                
                // Danger zone outside
                const dangerGradient = this.ctx.createRadialGradient(
                    this.safeZone.x, this.safeZone.y, this.safeZone.radius,
                    this.safeZone.x, this.safeZone.y, this.safeZone.radius + 50
                );
                dangerGradient.addColorStop(0, 'rgba(239, 68, 68, 0.3)');
                dangerGradient.addColorStop(1, 'rgba(239, 68, 68, 0)');
                
                this.ctx.fillStyle = dangerGradient;
                this.ctx.beginPath();
                this.ctx.arc(this.safeZone.x, this.safeZone.y, this.safeZone.radius + 50, 0, Math.PI * 2);
                this.ctx.fill();
            }
            
            drawPlayer() {
                if (!this.player.alive) return;
                
                // Player shadow
                this.ctx.shadowColor = '#3b82f6';
                this.ctx.shadowBlur = 20;
                
                // Player circle
                this.ctx.fillStyle = '#ffffff';
                this.ctx.beginPath();
                this.ctx.arc(this.player.x, this.player.y, this.player.size, 0, Math.PI * 2);
                this.ctx.fill();
                
                // Player health ring
                this.ctx.strokeStyle = this.player.health > 50 ? '#10b981' : '#ef4444';
                this.ctx.lineWidth = 3;
                this.ctx.beginPath();
                this.ctx.arc(this.player.x, this.player.y, this.player.size + 5, 0, Math.PI * 2 * (this.player.health / 100));
                this.ctx.stroke();
                
                this.ctx.shadowBlur = 0;
                
                // Player emoji
                this.ctx.font = '16px Arial';
                this.ctx.fillStyle = '#000000';
                this.ctx.textAlign = 'center';
                this.ctx.textBaseline = 'middle';
                this.ctx.fillText('üë§', this.player.x, this.player.y);
            }
            
            drawReactions() {
                this.reactions.forEach(reaction => {
                    this.ctx.globalAlpha = reaction.opacity;
                    this.ctx.font = '24px Arial';
                    this.ctx.fillStyle = reaction.color || '#ffffff';
                    this.ctx.textAlign = 'center';
                    this.ctx.textBaseline = 'middle';
                    this.ctx.fillText(reaction.emoji, reaction.x, reaction.y);
                });
                this.ctx.globalAlpha = 1;
            }
            
            drawGameInfo() {
                // Draw game time
                this.ctx.font = '16px Arial';
                this.ctx.fillStyle = '#ffffff';
                this.ctx.textAlign = 'right';
                this.ctx.fillText(`Time: ${this.gameTime.toFixed(1)}s`, 780, 30);
                
                // Draw players alive
                const aliveCount = this.bots.filter(b => b.alive).length + (this.player.alive ? 1 : 0);
                this.ctx.fillText(`Players: ${aliveCount}/10`, 780, 55);
                
                // Draw safe zone radius
                this.ctx.fillText(`Zone: ${Math.round(this.safeZone.radius)}px`, 780, 80);
            }
            
            addReaction(x, y, emoji, colorClass) {
                this.reactions.push({
                    x, y, emoji, colorClass,
                    opacity: 1,
                    life: 2.0
                });
                
                // Also create DOM element for animation
                this.createReactionPopup(x, y, emoji, colorClass);
            }
            
            createReactionPopup(x, y, emoji, colorClass) {
                const container = document.getElementById('reactionContainer');
                const popup = document.createElement('div');
                popup.className = `reaction-popup ${colorClass}`;
                popup.textContent = emoji;
                popup.style.left = `${x}px`;
                popup.style.top = `${y}px`;
                container.appendChild(popup);
                
                setTimeout(() => popup.remove(), 2000);
            }
            
            updateReactions(deltaTime) {
                for (let i = this.reactions.length - 1; i >= 0; i--) {
                    const reaction = this.reactions[i];
                    reaction.life -= deltaTime;
                    reaction.opacity = Math.min(1, reaction.life / 2);
                    reaction.y -= 50 * deltaTime;
                    
                    if (reaction.life <= 0) {
                        this.reactions.splice(i, 1);
                    }
                }
            }
            
            addChatMessage(message, type = 'player') {
                const container = document.getElementById('chatMessages');
                const messageDiv = document.createElement('div');
                
                const colors = {
                    player: 'text-blue-400',
                    bot: 'text-green-400',
                    system: 'text-yellow-400'
                };
                
                messageDiv.className = `text-sm ${colors[type] || 'text-gray-300'}`;
                messageDiv.innerHTML = message;
                
                container.appendChild(messageDiv);
                container.scrollTop = container.scrollHeight;
                
                // Keep only last 20 messages
                while (container.children.length > 20) {
                    container.removeChild(container.firstChild);
                }
                
                this.chatMessages.push({ message, type, time: Date.now() });
            }
            
            randomGameEvent() {
                const events = [
                    () => {
                        this.addChatMessage('‚ö†Ô∏è Zone is shrinking faster!', 'system');
                        this.safeZone.shrinkSpeed = 1;
                        setTimeout(() => this.safeZone.shrinkSpeed = 0.5, 10000);
                    },
                    () => {
                        this.addChatMessage('‚ö° Speed boost activated!', 'system');
                        this.bots.forEach(bot => bot.speed *= 1.5);
                        setTimeout(() => this.bots.forEach(bot => bot.speed /= 1.5), 5000);
                    },
                    () => {
                        const x = 100 + Math.random() * 600;
                        const y = 100 + Math.random() * 400;
                        this.addReaction(x, y, 'üíé', 'text-yellow-400');
                        this.addChatMessage('üíé Power-up appeared on the map!', 'system');
                    }
                ];
                
                events[Math.floor(Math.random() * events.length)]();
            }
            
            endGame(victory) {
                this.gameActive = false;
                
                // Calculate rewards
                const survivalTime = this.gameTime;
                const eliminations = this.eliminations;
                const reward = victory ? 
                    Math.floor(14500 * (0.7 + Math.random() * 0.3)) : 
                    Math.floor(14500 * (0.1 + Math.random() * 0.2));
                
                const eloChange = victory ? 
                    Math.floor(20 + eliminations * 2) : 
                    -Math.floor(10 + (10 - eliminations));
                
                // Update UI
                document.getElementById('gameUI').classList.add('hidden');
                document.getElementById('gameOverScreen').classList.remove('hidden');
                
                if (victory) {
                    document.getElementById('victoryIcon').className = 
                        'w-32 h-32 mx-auto mb-6 rounded-full bg-gradient-to-r from-yellow-600 to-orange-600 flex items-center justify-center';
                    document.getElementById('victoryIcon').innerHTML = '<i class="fas fa-trophy text-5xl"></i>';
                    document.getElementById('gameResultTitle').textContent = 'VICTORY!';
                    document.getElementById('gameResultSubtitle').textContent = 'You are the last survivor!';
                } else {
                    document.getElementById('victoryIcon').className = 
                        'w-32 h-32 mx-auto mb-6 rounded-full bg-gradient-to-r from-red-600 to-pink-600 flex items-center justify-center';
                    document.getElementById('victoryIcon').innerHTML = '<i class="fas fa-skull-crossbones text-5xl"></i>';
                    document.getElementById('gameResultTitle').textContent = 'DEFEAT';
                    document.getElementById('gameResultSubtitle').textContent = 'Better luck next time!';
                }
                
                document.getElementById('rewardAmount').textContent = `$${reward}`;
                document.getElementById('eloChange').textContent = `${eloChange > 0 ? '+' : ''}${eloChange}`;
                document.getElementById('eloChange').className = `text-3xl font-bold ${eloChange > 0 ? 'text-green-400' : 'text-red-400'}`;
                document.getElementById('matchTime').textContent = `${survivalTime.toFixed(1)} seconds`;
                document.getElementById('eliminations').textContent = eliminations;
                
                // Update player stats
                this.updatePlayerStats(victory, reward, eloChange);
                
                // Add result to chat
                const resultMsg = victory ? 
                    `Player won the match and earned $${reward}!` :
                    `Player was eliminated after ${survivalTime.toFixed(1)} seconds.`;
                this.addChatMessage(resultMsg, 'system');
            }
            
            updatePlayerStats(victory, reward, eloChange) {
                // Update local stats
                const wins = parseInt(document.getElementById('wins').textContent) + (victory ? 1 : 0);
                const losses = parseInt(document.getElementById('losses').textContent) + (victory ? 0 : 1);
                const totalMatches = wins + losses;
                const winRate = Math.round((wins / totalMatches) * 100);
                
                document.getElementById('wins').textContent = wins;
                document.getElementById('losses').textContent = losses;
                document.getElementById('totalMatches').textContent = totalMatches;
                document.getElementById('winRate').textContent = `${winRate}%`;
                
                // Update win streak
                if (victory) {
                    const streak = parseInt(document.getElementById('winStreak').textContent) + 1;
                    document.getElementById('winStreak').textContent = streak;
                    
                    if (streak >= 3) {
                        this.unlockAchievement(`Win Streak ${streak}`);
                    }
                } else {
                    document.getElementById('winStreak').textContent = '0';
                }
                
                // Update ELO
                const currentElo = parseInt(document.getElementById('playerElo').textContent);
                const newElo = Math.max(0, currentElo + eloChange);
                document.getElementById('playerElo').textContent = newElo;
                
                // Update average survival time
                const currentAvg = parseFloat(document.getElementById('avgTime').textContent);
                const newAvg = ((currentAvg * (totalMatches - 1)) + this.gameTime) / totalMatches;
                document.getElementById('avgTime').textContent = newAvg.toFixed(1);
            }
            
            populateInitialChat() {
                const initialMessages = [
                    { msg: "Welcome to Skill Arena! 342 players online.", type: "system" },
                    { msg: "CryptoWhale: Anyone for a high-stakes match?", type: "bot" },
                    { msg: "AlphaTrader: My ELO is 1620, who can beat that?", type: "bot" },
                    { msg: "MarsShot: Just won $2,450 in the last tournament!", type: "bot" },
                    { msg: "RichKidNFT: Buying premium skins if anyone selling", type: "bot" },
                    { msg: "DeFiKing: New tournament starting in 5 minutes!", type: "bot" }
                ];
                
                initialMessages.forEach(msg => {
                    setTimeout(() => {
                        this.addChatMessage(msg.msg, msg.type);
                    }, Math.random() * 3000);
                });
            }
            
            updateActivePlayers() {
                const container = document.getElementById('activePlayers');
                const players = [
                    { name: 'CryptoWhale', elo: 1678, status: 'In Match' },
                    { name: 'AlphaTrader', elo: 1620, status: 'Online' },
                    { name: 'MarsShot', elo: 1589, status: 'In Lobby' },
                    { name: 'RichKidNFT', elo: 1543, status: 'Online' },
                    { name: 'DeFiKing', elo: 1521, status: 'In Match' },
                    { name: 'Web3Warrior', elo: 1498, status: 'Online' },
                    { name: 'TokenMaster', elo: 1476, status: 'Away' },
                    { name: 'BlockchainBro', elo: 1454, status: 'Online' }
                ];
                
                container.innerHTML = '';
                players.forEach(player => {
                    const statusColor = player.status === 'In Match' ? 'text-red-400' :
                                       player.status === 'Online' ? 'text-green-400' : 'text-yellow-400';
                    
                    container.innerHTML += `
                        <div class="flex items-center justify-between p-2 hover:bg-gray-800/50 rounded-lg transition">
                            <div class="flex items-center space-x-3">
                                <div class="w-8 h-8 bg-gray-800 rounded-lg flex items-center justify-center">
                                    ${player.name.charAt(0)}
                                </div>
                                <div>
                                    <p class="text-sm font-bold">${player.name}</p>
                                    <p class="text-xs text-gray-400">ELO ${player.elo}</p>
                                </div>
                            </div>
                            <span class="text-xs ${statusColor}">${player.status}</span>
                        </div>
                    `;
                });
                
                // Update online count
                const onlineCount = players.filter(p => p.status !== 'Away').length;
                document.getElementById('onlineCount').textContent = 342 + onlineCount;
            }
            
            updateTournamentLeaderboard() {
                const container = document.getElementById('tournamentLeaderboard');
                const leaderboard = [
                    { position: 1, name: 'CryptoWhale', kills: 8, time: '42.7s', prize: '$1,450' },
                    { position: 2, name: 'AlphaTrader', kills: 7, time: '38.2s', prize: '$890' },
                    { position: 3, name: 'MarsShot', kills: 6, time: '35.1s', prize: '$560' },
                    { position: 4, name: 'DeFiKing', kills: 5, time: '31.8s', prize: '$340' },
                    { position: 5, name: 'You', kills: 4, time: '28.4s', prize: '$210' }
                ];
                
                container.innerHTML = '';
                leaderboard.forEach(entry => {
                    const isPlayer = entry.name === 'You';
                    container.innerHTML += `
                        <div class="flex items-center justify-between p-3 ${isPlayer ? 'bg-gradient-to-r from-indigo-600/20 to-purple-600/20' : 'bg-gray-900/30'} rounded-xl">
                            <div class="flex items-center space-x-3">
                                <div class="w-8 h-8 ${entry.position <= 3 ? 'bg-gradient-to-r from-yellow-600 to-orange-600' : 'bg-gray-800'} rounded-lg flex items-center justify-center font-bold">
                                    ${entry.position}
                                </div>
                                <div>
                                    <p class="text-sm font-bold ${isPlayer ? 'text-blue-400' : ''}">${entry.name}</p>
                                    <p class="text-xs text-gray-400">${entry.kills} kills ‚Ä¢ ${entry.time}</p>
                                </div>
                            </div>
                            <span class="text-sm font-bold text-green-400">${entry.prize}</span>
                        </div>
                    `;
                });
            }
            
            updateAchievements() {
                const container = document.getElementById('achievementsList');
                const achievements = [
                    { title: 'First Blood', desc: 'Win your first match', unlocked: true, icon: 'ü©∏' },
                    { title: 'Survivor', desc: 'Survive for 60 seconds', unlocked: true, icon: 'üõ°Ô∏è' },
                    { title: 'Kill Streak', desc: 'Eliminate 3+ players', unlocked: false, icon: '‚öîÔ∏è' },
                    { title: 'Untouchable', desc: 'Win without taking damage', unlocked: false, icon: 'üëë' },
                    { title: 'Comeback King', desc: 'Win from <10% HP', unlocked: false, icon: 'üéØ' }
                ];
                
                container.innerHTML = '';
                achievements.forEach(achievement => {
                    container.innerHTML += `
                        <div class="flex items-center space-x-3 p-2 ${achievement.unlocked ? 'bg-green-900/20' : 'bg-gray-900/30'} rounded-lg">
                            <div class="w-10 h-10 ${achievement.unlocked ? 'bg-gradient-to-r from-green-600 to-emerald-600' : 'bg-gray-800'} rounded-lg flex items-center justify-center">
                                <span class="text-lg">${achievement.icon}</span>
                            </div>
                            <div class="flex-1">
                                <p class="text-sm font-bold">${achievement.title}</p>
                                <p class="text-xs text-gray-400">${achievement.desc}</p>
                            </div>
                            ${achievement.unlocked ? 
                                '<span class="text-green-400 text-xs"><i class="fas fa-check"></i></span>' :
                                '<span class="text-gray-500 text-xs"><i class="fas fa-lock"></i></span>'
                            }
                        </div>
                    `;
                });
            }
            
            updateFriendsActivity() {
                const container = document.getElementById('friendsActivity');
                const activities = [
                    { name: 'CryptoQueen', action: 'won $1,240', time: '2 min ago', icon: 'üéâ' },
                    { name: 'SolanaKing', action: 'reached ELO 1700', time: '15 min ago', icon: 'üëë' },
                    { name: 'NFTMaster', action: 'bought Dragon Skin', time: '1 hour ago', icon: 'üõçÔ∏è' },
                    { name: 'BlockchainPro', action: 'on 5-win streak', time: '2 hours ago', icon: 'üî•' }
                ];
                
                container.innerHTML = '';
                activities.forEach(activity => {
                    container.innerHTML += `
                        <div class="flex items-center space-x-3 p-2 hover:bg-gray-800/30 rounded-lg transition">
                            <div class="w-8 h-8 bg-gray-800 rounded-lg flex items-center justify-center">
                                <span class="text-sm">${activity.icon}</span>
                            </div>
                            <div class="flex-1">
                                <p class="text-sm">
                                    <span class="font-bold">${activity.name}</span> 
                                    <span class="text-gray-400">${activity.action}</span>
                                </p>
                                <p class="text-xs text-gray-500">${activity.time}</p>
                            </div>
                        </div>
                    `;
                });
            }
            
            unlockAchievement(title) {
                // Show achievement popup
                const achievement = document.createElement('div');
                achievement.className = 'fixed top-4 left-1/2 transform -translate-x-1/2 glass rounded-xl p-4 min-w-[300px] z-50 achievement-unlock';
                achievement.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <div class="w-12 h-12 bg-gradient-to-r from-yellow-600 to-orange-600 rounded-lg flex items-center justify-center">
                            <i class="fas fa-trophy text-xl"></i>
                        </div>
                        <div>
                            <p class="font-bold">Achievement Unlocked!</p>
                            <p class="text-sm text-gray-300">${title}</p>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(achievement);
                
                setTimeout(() => {
                    achievement.style.opacity = '0';
                    achievement.style.transform = 'translateX(-50%) translateY(-20px)';
                    setTimeout(() => achievement.remove(), 300);
                }, 3000);
            }
        }
        
        // Initialize Game
        document.addEventListener('DOMContentLoaded', () => {
            const game = new PvPGameEngine();
            
            // Matchmaking simulation
            document.getElementById('startMatchmaking').addEventListener('click', () => {
                document.getElementById('matchmakingStatus').classList.remove('hidden');
                document.getElementById('matchmakingScreen').style.display = 'none';
                
                // Simulate matchmaking progress
                let progress = 0;
                let playersFound = 0;
                
                const matchmakingInterval = setInterval(() => {
                    progress += Math.random() * 10;
                    playersFound += Math.random() > 0.7 ? 1 : 0;
                    
                    document.getElementById('matchmakingProgress').style.width = `${Math.min(100, progress)}%`;
                    document.getElementById('playersFound').textContent = `${Math.min(9, playersFound)}/9`;
                    
                    // Update skill range based on "found players"
                    const baseElo = 1500;
                    const range = 100 + playersFound * 20;
                    document.getElementById('skillRange').textContent = 
                        `${baseElo - range}-${baseElo + range} ELO`;
                    
                    // When match found
                    if (progress >= 100 && playersFound >= 9) {
                        clearInterval(matchmakingInterval);
                        
                        // Add realistic delay before starting
                        setTimeout(() => {
                            document.getElementById('matchmakingStatus').classList.add('hidden');
                            game.startMatch();
                            
                            // Simulate opponents connecting
                            setTimeout(() => {
                                game.addChatMessage('All players connected. Match starting!', 'system');
                            }, 1000);
                        }, 1500);
                    }
                }, 500);
                
                // Cancel matchmaking
                document.getElementById('cancelMatchmaking').addEventListener('click', () => {
                    clearInterval(matchmakingInterval);
                    document.getElementById('matchmakingStatus').classList.add('hidden');
                    document.getElementById('matchmakingScreen').style.display = 'flex';
                }, { once: true });
            });
            
            // Play again button
            document.getElementById('playAgainBtn').addEventListener('click', () => {
                document.getElementById('gameOverScreen').classList.add('hidden');
                document.getElementById('matchmakingScreen').style.display = 'flex';
            });
            
            // Share result button
            document.getElementById('shareResultBtn').addEventListener('click', () => {
                alert('Result shared to social media! (Simulated)');
            });
            
            // Chat system
            document.getElementById('sendMessage').addEventListener('click', sendMessage);
            document.getElementById('chatInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') sendMessage();
            });
            
            function sendMessage() {
                const input = document.getElementById('chatInput');
                const message = input.value.trim();
                
                if (message) {
                    game.addChatMessage(`You: ${message}`, 'player');
                    input.value = '';
                    
                    // Simulate bot responses
                    setTimeout(() => {
                        if (Math.random() > 0.5) {
                            const bots = game.bots.filter(b => b.alive);
                            if (bots.length > 0) {
                                const randomBot = bots[Math.floor(Math.random() * bots.length)];
                                randomBot.sendChatMessage(game);
                            }
                        }
                    }, 1000 + Math.random() * 2000);
                }
            }
            
            // Initialize player stats
            updatePlayerStats();
            
            function updatePlayerStats() {
                // Simulate live updates
                setInterval(() => {
                    const wins = parseInt(document.getElementById('wins').textContent);
                    const losses = parseInt(document.getElementById('losses').textContent);
                    const winRate = Math.round((wins / (wins + losses)) * 100);
                    
                    document.getElementById('winRate').textContent = `${winRate}%`;
                    
                    // Update online count with random fluctuation
                    const current = parseInt(document.getElementById('onlineCount').textContent);
                    const change = Math.floor(Math.random() * 10) - 5;
                    document.getElementById('onlineCount').textContent = Math.max(300, current + change);
                }, 10000);
            }
            
            // Add tilt effect to game canvas
            const canvas = document.getElementById('gameCanvas');
            canvas.addEventListener('mousemove', (e) => {
                const rect = canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                const tiltX = (x / rect.width - 0.5) * 10;
                const tiltY = (y / rect.height - 0.5) * 10;
                
                canvas.style.transform = `perspective(1000px) rotateX(${-tiltY}deg) rotateY(${tiltX}deg)`;
            });
            
            canvas.addEventListener('mouseleave', () => {
                canvas.style.transform = 'perspective(1000px) rotateX(0deg) rotateY(0deg)';
            });
            
            // Simulate live tournament updates
            setInterval(() => {
                game.updateTournamentLeaderboard();
                game.updateActivePlayers();
                game.updateFriendsActivity();
            }, 15000);
            
            // Add elimination flash effect
            window.addEventListener('elimination', (e) => {
                document.getElementById('gameCanvas').classList.add('elimination-flash');
                setTimeout(() => {
                    document.getElementById('gameCanvas').classList.remove('elimination-flash');
                }, 1000);
            });
        });
    </script>
</body>
</html>